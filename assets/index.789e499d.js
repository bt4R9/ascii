var z=Object.defineProperty;var B=(l,e,t)=>e in l?z(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var c=(l,e,t)=>(B(l,typeof e!="symbol"?e+"":e,t),t),P=(l,e,t)=>{if(!e.has(l))throw TypeError("Cannot "+t)};var x=(l,e,t)=>(P(l,e,"read from private field"),t?t.call(l):e.get(l)),E=(l,e,t)=>{if(e.has(l))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(l):e.set(l,t)},L=(l,e,t,a)=>(P(l,e,"write to private field"),a?a.call(l,t):e.set(l,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function t(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerpolicy&&(h.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?h.credentials="include":i.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function a(i){if(i.ep)return;i.ep=!0;const h=t(i);fetch(i.href,h)}})();var w,I,_;class k{constructor(e){c(this,"canvas");c(this,"context");c(this,"resolution",4);E(this,w,new Uint8ClampedArray);E(this,I,0);E(this,_,0);c(this,"mode","basic");c(this,"inversion",!1);c(this,"basicSymbols",[" ",".",":","-","=","+","*","#","%","@"]);c(this,"advancedSymbols",[" ",".","'","`","^",'"',",",":",";","I","l","!","i",">","<","~","+","_","-","?","]","[","}","{","1",")","(","|","/","t","f","j","r","x","n","u","v","c","z","X","Y","U","J","C","L","Q","0","O","Z","m","w","q","p","d","b","k","h","a","o","*","#","M","W","&","8","%","B","@","$"]);this.canvas=e,this.context=e.getContext("2d",{willReadFrequently:!0})}getSymbol(e,t,a){const i=(e+t+a)/3|0;let h=i/255;if(this.inversion||(h=1-h),this.mode==="basic"){if(i===0)return this.basicSymbols[9];const f=(1-i/255)*10|0;return this.basicSymbols[f]}const p=this.advancedSymbols.length*h|0;return this.advancedSymbols[p]}averageColor(e,t){let a=0,i=0,h=0,p=0;for(let f=e;e<Math.min(x(this,I),e+this.resolution);e++)for(let u=t;t<Math.min(x(this,_),t+this.resolution);t++){p+=1;const n=(f*x(this,_)+u)*4,r=x(this,w)[n],o=x(this,w)[n+1],m=x(this,w)[n+2];a+=r,i+=o,h+=m}return a=a/p|0,i=i/p|0,h=h/p|0,{R:a,G:i,B:h}}transform(){L(this,w,this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data),L(this,I,this.canvas.height),L(this,_,this.canvas.width);const e=[];for(let t=0;t<x(this,I);t+=this.resolution)for(let a=0;a<x(this,_);a+=this.resolution){const{R:i,G:h,B:p}=this.averageColor(t,a),f=this.getSymbol(i,h,p);e.push({y:t,x:a,symbol:f})}return e}}w=new WeakMap,I=new WeakMap,_=new WeakMap;class R{constructor(e,t,a){c(this,"canvas");c(this,"helper");c(this,"video");c(this,"canvasContext");c(this,"helperContext");c(this,"ascii");c(this,"frameId",-1);c(this,"animate",()=>{this.frameId=requestAnimationFrame(this.animate),this.helperContext.drawImage(this.video,0,0,this.helper.width,this.helper.height);const e=this.ascii.transform();this.ascii.inversion?(this.canvasContext.fillStyle="#000",this.canvasContext.fillRect(0,0,this.helper.width,this.helper.height)):this.canvasContext.clearRect(0,0,this.helper.width,this.helper.height),this.canvasContext.fillStyle=this.ascii.inversion?"#fff":"#000",this.canvasContext.font=`${this.ascii.resolution*1.5}px monospace`;for(const t of e)this.canvasContext.fillText(t.symbol,t.x,t.y)});this.canvas=e,this.helper=t,this.video=a,this.canvasContext=e.getContext("2d"),this.helperContext=t.getContext("2d"),this.ascii=new k(this.helper)}start(){this.animate()}stop(){cancelAnimationFrame(this.frameId)}}var A={exports:{}};(function(l){var e=Object.prototype.hasOwnProperty,t="~";function a(){}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(t=!1));function i(u,n,r){this.fn=u,this.context=n,this.once=r||!1}function h(u,n,r,o,m){if(typeof r!="function")throw new TypeError("The listener must be a function");var g=new i(r,o||u,m),d=t?t+n:n;return u._events[d]?u._events[d].fn?u._events[d]=[u._events[d],g]:u._events[d].push(g):(u._events[d]=g,u._eventsCount++),u}function p(u,n){--u._eventsCount===0?u._events=new a:delete u._events[n]}function f(){this._events=new a,this._eventsCount=0}f.prototype.eventNames=function(){var n=[],r,o;if(this._eventsCount===0)return n;for(o in r=this._events)e.call(r,o)&&n.push(t?o.slice(1):o);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(r)):n},f.prototype.listeners=function(n){var r=t?t+n:n,o=this._events[r];if(!o)return[];if(o.fn)return[o.fn];for(var m=0,g=o.length,d=new Array(g);m<g;m++)d[m]=o[m].fn;return d},f.prototype.listenerCount=function(n){var r=t?t+n:n,o=this._events[r];return o?o.fn?1:o.length:0},f.prototype.emit=function(n,r,o,m,g,d){var y=t?t+n:n;if(!this._events[y])return!1;var s=this._events[y],C=arguments.length,b,v;if(s.fn){switch(s.once&&this.removeListener(n,s.fn,void 0,!0),C){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,r),!0;case 3:return s.fn.call(s.context,r,o),!0;case 4:return s.fn.call(s.context,r,o,m),!0;case 5:return s.fn.call(s.context,r,o,m,g),!0;case 6:return s.fn.call(s.context,r,o,m,g,d),!0}for(v=1,b=new Array(C-1);v<C;v++)b[v-1]=arguments[v];s.fn.apply(s.context,b)}else{var O=s.length,S;for(v=0;v<O;v++)switch(s[v].once&&this.removeListener(n,s[v].fn,void 0,!0),C){case 1:s[v].fn.call(s[v].context);break;case 2:s[v].fn.call(s[v].context,r);break;case 3:s[v].fn.call(s[v].context,r,o);break;case 4:s[v].fn.call(s[v].context,r,o,m);break;default:if(!b)for(S=1,b=new Array(C-1);S<C;S++)b[S-1]=arguments[S];s[v].fn.apply(s[v].context,b)}}return!0},f.prototype.on=function(n,r,o){return h(this,n,r,o,!1)},f.prototype.once=function(n,r,o){return h(this,n,r,o,!0)},f.prototype.removeListener=function(n,r,o,m){var g=t?t+n:n;if(!this._events[g])return this;if(!r)return p(this,g),this;var d=this._events[g];if(d.fn)d.fn===r&&(!m||d.once)&&(!o||d.context===o)&&p(this,g);else{for(var y=0,s=[],C=d.length;y<C;y++)(d[y].fn!==r||m&&!d[y].once||o&&d[y].context!==o)&&s.push(d[y]);s.length?this._events[g]=s.length===1?s[0]:s:p(this,g)}return this},f.prototype.removeAllListeners=function(n){var r;return n?(r=t?t+n:n,this._events[r]&&p(this,r)):(this._events=new a,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=t,f.EventEmitter=f,l.exports=f})(A);const M=A.exports;class N{constructor(){c(this,"events",new M);c(this,"pixelSizeInput",document.getElementById("pixel-size"));c(this,"pixelSizeValue",document.getElementById("pixel-size-value"));c(this,"advancedPaletteInput",document.getElementById("advanced-palette"));c(this,"inversionInput",document.getElementById("inversion"));c(this,"onPixelSizeChange",()=>{const e=this.pixelSizeInput.value;this.pixelSizeValue.textContent=`${e}px`,this.events.emit("onPixelSizeChange",parseInt(e))});c(this,"onAdvancedPaletteChange",()=>{const e=this.advancedPaletteInput.checked;this.events.emit("onAdvancedPaletteChange",e)});c(this,"onInversionChange",()=>{const e=this.inversionInput.checked;this.events.emit("onInversionChange",e)});this.pixelSizeInput.addEventListener("change",this.onPixelSizeChange),this.advancedPaletteInput.addEventListener("change",this.onAdvancedPaletteChange),this.inversionInput.addEventListener("change",this.onInversionChange)}}class j{constructor(e){c(this,"video");this.video=e}async start(){const e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480},audio:!1});this.video.srcObject=e,this.video.play()}stop(){this.video.pause(),this.video.srcObject=null}}class q{constructor(e,t,a){c(this,"stream");c(this,"renderer");c(this,"settings");this.renderer=new R(e,t,a),this.stream=new j(a),this.settings=new N,this.settings.events.on("onPixelSizeChange",i=>{this.renderer.ascii.resolution=i}),this.settings.events.on("onAdvancedPaletteChange",i=>{this.renderer.ascii.mode=i?"advanced":"basic"}),this.settings.events.on("onInversionChange",i=>{document.body.classList.toggle("inversion",i),this.renderer.ascii.inversion=i})}async init(){await this.stream.start(),this.renderer.start()}}const F=document.getElementById("canvas"),T=document.getElementById("helper"),U=document.getElementById("video"),$=new q(F,T,U);$.init();
